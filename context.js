'use strict';

const delegate = require('delegates');
const Request = require('./request');
const Response = require('./response');

var HttpRequest;
try {
  HttpRequest = require('http-incoming').IncomingMessage;
} catch (e) {
  HttpRequest = require('http').IncomingMessage;
}

var HttpResponse;
try {
  HttpResponse = require('http-outgoing').OutgoingMessage;
} catch (e) {
  HttpResponse = require('http').OutgoingMessage;
}


class Context {
  constructor(url) {
    this.req = new HttpRequest({});
    this.res = new HttpResponse();

    this.request = new Request(this);
    this.response = new Response(this);

    this.url = url;
  }
}

delegate(Context.prototype, 'response')
  .method('attachment')
  .method('redirect')
  .method('remove')
  .method('vary')
  .method('set')
  .method('append')
  .method('flushHeaders')
  .access('status')
  .access('message')
  .access('body')
  .access('length')
  .access('type')
  .access('lastModified')
  .access('etag')
  .getter('headerSent')
  .getter('writable');

/**
 * Request delegation.
 */

delegate(Context.prototype, 'request')
  .method('acceptsLanguages')
  .method('acceptsEncodings')
  .method('acceptsCharsets')
  .method('accepts')
  .method('get')
  .method('is')
  .access('querystring')
  .access('idempotent')
  .access('socket')
  .access('search')
  .access('method')
  .access('query')
  .access('path')
  .access('url')
  .getter('origin')
  .getter('href')
  .getter('subdomains')
  .getter('protocol')
  .getter('host')
  .getter('hostname')
  .getter('header')
  .getter('headers')
  .getter('secure')
  .getter('stale')
  .getter('fresh')
  .getter('ips')
  .getter('ip');

module.exports = Context;